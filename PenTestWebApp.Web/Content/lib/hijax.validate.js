
$(function () {
    function showInputErrors(form, errors) {
        var summary = "";
        var prefix = form.data("prefix") || "";
        $.each(errors, function () {
            // can't use :input selector here, doesn't find elements all the time (see portfolio extended properties and alert types)
            var element = $('input[name="' + prefix + this.Property + '"],select[name="' + prefix + this.Property + '"]');
            element.addClass("input-validation-error").attr("_title", element.attr("title")).attr("title", this.Message);
            summary += "<li><label for=\"" + prefix + this.Property + "\">" + this.Message + "</label></li>";
        });
        $(".validation-summary-errors", form).html("<ul>" + summary + "</ul>").show();
    }
    function hideInputErrors(form) {
        $(".validation-summary-errors", form).hide().html("");
        $(":input", form).each(function () {
            var $this = $(this);
            $this.removeClass("input-validation-error").attr("title", $this.attr("_title"));
        });
    }

    $.hijaxSetup(
        {
            request: function () { hideInputErrors($(this)); },
            validation: function (xhr, response) { showInputErrors($(this), response); },
            authentication: function () { alert("Whoops! It looks like your session expired.  You will need to login again before you can continue."); },
            failure: function () { alert("Whoops! Something's wrong. But don't worry, it's not your fault. It looks like our system isn't responding properly right now. We have notified our developers that there is a problem. Give it a minute and try again."); }
        }
    );
});
