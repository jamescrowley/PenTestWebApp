(function($) {
    window.penTestApp = function (appOptions) {
        var attachAjaxForms = function () {
            $("form.hijax").hijax();
        };

        function setupGlobalCSRFAjax() {
            var csrfToken = { '__RequestVerificationToken': appOptions.antiForgeryToken };

            $.ajaxPrefilter(function(options, originalOptions) {
                // do not send data for GET
                if (originalOptions.type === 'GET' || options.type === 'GET') {
                    return;
                }
                if (typeof (options.data) === "string") {
                    options.data = options.data + "&" + $.param(csrfToken);
                } else {
                    options.data = $.extend(originalOptions.data, csrfToken);
                }
            });
        }

        return {
            init: function() {
                setupGlobalCSRFAjax();
                attachAjaxForms();
            }
        }
    }
})(jQuery);